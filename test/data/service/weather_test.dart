import 'package:flutter_test/flutter_test.dart';
import 'package:mocktail/mocktail.dart';
import 'package:dio/dio.dart';
import 'package:weather_app/data/service/dio.dart';
import 'package:weather_app/data/service/endpoints.dart';
import 'package:weather_app/data/service/weather.dart';
import 'package:weather_app/domiain/model/weather_forecast.dart';

class MockDioClient extends Mock implements DioClient {}

void main() {
  late MockDioClient mockDioClient;
  late WeatherApiServiceImpl weatherApi;

  setUp(() {
    mockDioClient = MockDioClient();
    weatherApi = WeatherApiServiceImpl(dioClient: mockDioClient);

    // Register fallback for queryParameters
    registerFallbackValue(<String, dynamic>{});
  });

  group('WeatherApiServiceImpl Tests (mocktail)', () {
    test('returns Weather object when response is successful', () async {
      final mockJson = {
        "location": {
          "name": "Paris",
          "region": "Ile-de-France",
          "country": "France",
          "lat": 48.867,
          "lon": 2.333,
          "tz_id": "Europe/Paris",
          "localtime_epoch": 1754247498,
          "localtime": "2025-08-03 20:58"
        },
        "current": {
          "last_updated_epoch": 1754246700,
          "last_updated": "2025-08-03 20:45",
          "temp_c": 22.0,
          "temp_f": 71.6,
          "is_day": 1,
          "condition": {
            "text": "Sunny",
            "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
            "code": 1000
          },
          "wind_mph": 10.1,
          "wind_kph": 16.2,
          "wind_degree": 316,
          "wind_dir": "NW",
          "pressure_mb": 1021.0,
          "pressure_in": 30.15,
          "precip_mm": 0.0,
          "precip_in": 0.0,
          "humidity": 61,
          "cloud": 0,
          "feelslike_c": 24.5,
          "feelslike_f": 76.0,
          "windchill_c": 23.0,
          "windchill_f": 73.4,
          "heatindex_c": 24.8,
          "heatindex_f": 76.6,
          "dewpoint_c": 12.5,
          "dewpoint_f": 54.4,
          "vis_km": 10.0,
          "vis_miles": 6.0,
          "uv": 0.2,
          "gust_mph": 16.0,
          "gust_kph": 25.8
        },
        "forecast": {
          "forecastday": [
            {
              "date": "2025-08-03",
              "date_epoch": 1754179200,
              "day": {
                "maxtemp_c": 26.8,
                "maxtemp_f": 80.3,
                "mintemp_c": 13.3,
                "mintemp_f": 55.9,
                "avgtemp_c": 20.0,
                "avgtemp_f": 68.0,
                "maxwind_mph": 10.1,
                "maxwind_kph": 16.2,
                "totalprecip_mm": 0.01,
                "totalprecip_in": 0.0,
                "totalsnow_cm": 0.0,
                "avgvis_km": 10.0,
                "avgvis_miles": 6.0,
                "avghumidity": 53,
                "daily_will_it_rain": 0,
                "daily_chance_of_rain": 0,
                "daily_will_it_snow": 0,
                "daily_chance_of_snow": 0,
                "condition": {
                  "text": "Sunny",
                  "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                  "code": 1000
                },
                "uv": 1.8
              },
              "astro": {
                "sunrise": "06:27 AM",
                "sunset": "09:26 PM",
                "moonrise": "05:25 PM",
                "moonset": "12:31 AM",
                "moon_phase": "Waxing Gibbous",
                "moon_illumination": 64,
                "is_moon_up": 1,
                "is_sun_up": 0
              },
              "hour": [
                {
                  "time_epoch": 1754172000,
                  "time": "2025-08-03 00:00",
                  "temp_c": 15.5,
                  "temp_f": 60.0,
                  "is_day": 0,
                  "condition": {
                    "text": "Patchy rain nearby",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/176.png",
                    "code": 1063
                  },
                  "wind_mph": 2.2,
                  "wind_kph": 3.6,
                  "wind_degree": 43,
                  "wind_dir": "NE",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.14,
                  "precip_mm": 0.01,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 71,
                  "cloud": 81,
                  "feelslike_c": 15.5,
                  "feelslike_f": 60.0,
                  "windchill_c": 15.5,
                  "windchill_f": 60.0,
                  "heatindex_c": 15.5,
                  "heatindex_f": 60.0,
                  "dewpoint_c": 10.4,
                  "dewpoint_f": 50.6,
                  "will_it_rain": 1,
                  "chance_of_rain": 80,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 4.0,
                  "gust_kph": 6.5,
                  "uv": 0
                },
                {
                  "time_epoch": 1754175600,
                  "time": "2025-08-03 01:00",
                  "temp_c": 15.2,
                  "temp_f": 59.4,
                  "is_day": 0,
                  "condition": {
                    "text": "Clear ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/113.png",
                    "code": 1000
                  },
                  "wind_mph": 2.0,
                  "wind_kph": 3.2,
                  "wind_degree": 48,
                  "wind_dir": "NE",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.14,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 72,
                  "cloud": 17,
                  "feelslike_c": 15.2,
                  "feelslike_f": 59.4,
                  "windchill_c": 15.2,
                  "windchill_f": 59.4,
                  "heatindex_c": 15.2,
                  "heatindex_f": 59.4,
                  "dewpoint_c": 10.1,
                  "dewpoint_f": 50.2,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 3.6,
                  "gust_kph": 5.8,
                  "uv": 0
                },
                {
                  "time_epoch": 1754179200,
                  "time": "2025-08-03 02:00",
                  "temp_c": 14.7,
                  "temp_f": 58.5,
                  "is_day": 0,
                  "condition": {
                    "text": "Clear ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/113.png",
                    "code": 1000
                  },
                  "wind_mph": 1.1,
                  "wind_kph": 1.8,
                  "wind_degree": 15,
                  "wind_dir": "NNE",
                  "pressure_mb": 1020.0,
                  "pressure_in": 30.13,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 73,
                  "cloud": 5,
                  "feelslike_c": 14.7,
                  "feelslike_f": 58.5,
                  "windchill_c": 14.7,
                  "windchill_f": 58.5,
                  "heatindex_c": 14.7,
                  "heatindex_f": 58.5,
                  "dewpoint_c": 9.9,
                  "dewpoint_f": 49.9,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 2.1,
                  "gust_kph": 3.3,
                  "uv": 0
                },
                {
                  "time_epoch": 1754182800,
                  "time": "2025-08-03 03:00",
                  "temp_c": 14.2,
                  "temp_f": 57.6,
                  "is_day": 0,
                  "condition": {
                    "text": "Clear ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/113.png",
                    "code": 1000
                  },
                  "wind_mph": 2.0,
                  "wind_kph": 3.2,
                  "wind_degree": 316,
                  "wind_dir": "NW",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.14,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 74,
                  "cloud": 10,
                  "feelslike_c": 15.1,
                  "feelslike_f": 59.1,
                  "windchill_c": 15.1,
                  "windchill_f": 59.1,
                  "heatindex_c": 14.2,
                  "heatindex_f": 57.6,
                  "dewpoint_c": 9.7,
                  "dewpoint_f": 49.5,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 3.7,
                  "gust_kph": 6.0,
                  "uv": 0
                },
                {
                  "time_epoch": 1754186400,
                  "time": "2025-08-03 04:00",
                  "temp_c": 13.7,
                  "temp_f": 56.7,
                  "is_day": 0,
                  "condition": {
                    "text": "Clear ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/113.png",
                    "code": 1000
                  },
                  "wind_mph": 2.7,
                  "wind_kph": 4.3,
                  "wind_degree": 328,
                  "wind_dir": "NNW",
                  "pressure_mb": 1020.0,
                  "pressure_in": 30.13,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 72,
                  "cloud": 7,
                  "feelslike_c": 14.1,
                  "feelslike_f": 57.5,
                  "windchill_c": 14.1,
                  "windchill_f": 57.5,
                  "heatindex_c": 13.7,
                  "heatindex_f": 56.7,
                  "dewpoint_c": 8.9,
                  "dewpoint_f": 47.9,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 5.0,
                  "gust_kph": 8.1,
                  "uv": 0
                },
                {
                  "time_epoch": 1754190000,
                  "time": "2025-08-03 05:00",
                  "temp_c": 13.3,
                  "temp_f": 56.0,
                  "is_day": 0,
                  "condition": {
                    "text": "Clear ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/113.png",
                    "code": 1000
                  },
                  "wind_mph": 2.7,
                  "wind_kph": 4.3,
                  "wind_degree": 325,
                  "wind_dir": "NW",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.14,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 72,
                  "cloud": 6,
                  "feelslike_c": 13.7,
                  "feelslike_f": 56.7,
                  "windchill_c": 13.7,
                  "windchill_f": 56.7,
                  "heatindex_c": 13.3,
                  "heatindex_f": 56.0,
                  "dewpoint_c": 8.5,
                  "dewpoint_f": 47.2,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 5.0,
                  "gust_kph": 8.1,
                  "uv": 0
                },
                {
                  "time_epoch": 1754193600,
                  "time": "2025-08-03 06:00",
                  "temp_c": 13.3,
                  "temp_f": 55.9,
                  "is_day": 0,
                  "condition": {
                    "text": "Clear ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/113.png",
                    "code": 1000
                  },
                  "wind_mph": 2.5,
                  "wind_kph": 4.0,
                  "wind_degree": 318,
                  "wind_dir": "NW",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.15,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 71,
                  "cloud": 0,
                  "feelslike_c": 13.8,
                  "feelslike_f": 56.8,
                  "windchill_c": 13.8,
                  "windchill_f": 56.8,
                  "heatindex_c": 13.3,
                  "heatindex_f": 55.9,
                  "dewpoint_c": 8.2,
                  "dewpoint_f": 46.7,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 4.4,
                  "gust_kph": 7.1,
                  "uv": 0
                },
                {
                  "time_epoch": 1754197200,
                  "time": "2025-08-03 07:00",
                  "temp_c": 15.2,
                  "temp_f": 59.3,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 2.2,
                  "wind_kph": 3.6,
                  "wind_degree": 310,
                  "wind_dir": "NW",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.16,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 64,
                  "cloud": 3,
                  "feelslike_c": 15.2,
                  "feelslike_f": 59.3,
                  "windchill_c": 15.2,
                  "windchill_f": 59.3,
                  "heatindex_c": 15.2,
                  "heatindex_f": 59.3,
                  "dewpoint_c": 8.5,
                  "dewpoint_f": 47.2,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 3.0,
                  "gust_kph": 4.8,
                  "uv": 0.0
                },
                {
                  "time_epoch": 1754200800,
                  "time": "2025-08-03 08:00",
                  "temp_c": 16.9,
                  "temp_f": 62.4,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 2.7,
                  "wind_kph": 4.3,
                  "wind_degree": 276,
                  "wind_dir": "W",
                  "pressure_mb": 1022.0,
                  "pressure_in": 30.17,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 56,
                  "cloud": 3,
                  "feelslike_c": 16.9,
                  "feelslike_f": 62.4,
                  "windchill_c": 16.9,
                  "windchill_f": 62.4,
                  "heatindex_c": 16.9,
                  "heatindex_f": 62.4,
                  "dewpoint_c": 8.2,
                  "dewpoint_f": 46.7,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 3.1,
                  "gust_kph": 5.0,
                  "uv": 0.4
                },
                {
                  "time_epoch": 1754204400,
                  "time": "2025-08-03 09:00",
                  "temp_c": 18.6,
                  "temp_f": 65.6,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 3.1,
                  "wind_kph": 5.0,
                  "wind_degree": 262,
                  "wind_dir": "W",
                  "pressure_mb": 1022.0,
                  "pressure_in": 30.17,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 50,
                  "cloud": 2,
                  "feelslike_c": 18.6,
                  "feelslike_f": 65.6,
                  "windchill_c": 18.6,
                  "windchill_f": 65.6,
                  "heatindex_c": 18.6,
                  "heatindex_f": 65.6,
                  "dewpoint_c": 8.0,
                  "dewpoint_f": 46.5,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 3.6,
                  "gust_kph": 5.8,
                  "uv": 1.1
                },
                {
                  "time_epoch": 1754208000,
                  "time": "2025-08-03 10:00",
                  "temp_c": 20.3,
                  "temp_f": 68.5,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 4.3,
                  "wind_kph": 6.8,
                  "wind_degree": 266,
                  "wind_dir": "W",
                  "pressure_mb": 1022.0,
                  "pressure_in": 30.17,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 42,
                  "cloud": 0,
                  "feelslike_c": 20.3,
                  "feelslike_f": 68.5,
                  "windchill_c": 20.3,
                  "windchill_f": 68.5,
                  "heatindex_c": 20.3,
                  "heatindex_f": 68.5,
                  "dewpoint_c": 6.9,
                  "dewpoint_f": 44.4,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 4.9,
                  "gust_kph": 7.9,
                  "uv": 2.2
                },
                {
                  "time_epoch": 1754211600,
                  "time": "2025-08-03 11:00",
                  "temp_c": 21.6,
                  "temp_f": 70.9,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 4.9,
                  "wind_kph": 7.9,
                  "wind_degree": 271,
                  "wind_dir": "W",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.16,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 38,
                  "cloud": 17,
                  "feelslike_c": 21.6,
                  "feelslike_f": 70.9,
                  "windchill_c": 21.6,
                  "windchill_f": 70.9,
                  "heatindex_c": 23.8,
                  "heatindex_f": 74.8,
                  "dewpoint_c": 6.6,
                  "dewpoint_f": 43.9,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 5.7,
                  "gust_kph": 9.1,
                  "uv": 3.7
                },
                {
                  "time_epoch": 1754215200,
                  "time": "2025-08-03 12:00",
                  "temp_c": 22.9,
                  "temp_f": 73.2,
                  "is_day": 1,
                  "condition": {
                    "text": "Overcast ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/122.png",
                    "code": 1009
                  },
                  "wind_mph": 4.9,
                  "wind_kph": 7.9,
                  "wind_degree": 276,
                  "wind_dir": "W",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.15,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 35,
                  "cloud": 100,
                  "feelslike_c": 24.0,
                  "feelslike_f": 75.2,
                  "windchill_c": 22.9,
                  "windchill_f": 73.2,
                  "heatindex_c": 24.0,
                  "heatindex_f": 75.2,
                  "dewpoint_c": 6.7,
                  "dewpoint_f": 44.0,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 5.7,
                  "gust_kph": 9.1,
                  "uv": 5.3
                },
                {
                  "time_epoch": 1754218800,
                  "time": "2025-08-03 13:00",
                  "temp_c": 23.8,
                  "temp_f": 74.9,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 6.3,
                  "wind_kph": 10.1,
                  "wind_degree": 284,
                  "wind_dir": "WNW",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.15,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 33,
                  "cloud": 8,
                  "feelslike_c": 24.3,
                  "feelslike_f": 75.7,
                  "windchill_c": 23.8,
                  "windchill_f": 74.9,
                  "heatindex_c": 24.3,
                  "heatindex_f": 75.7,
                  "dewpoint_c": 6.7,
                  "dewpoint_f": 44.0,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 7.2,
                  "gust_kph": 11.6,
                  "uv": 6.5
                },
                {
                  "time_epoch": 1754222400,
                  "time": "2025-08-03 14:00",
                  "temp_c": 24.8,
                  "temp_f": 76.6,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 6.5,
                  "wind_kph": 10.4,
                  "wind_degree": 284,
                  "wind_dir": "WNW",
                  "pressure_mb": 1020.0,
                  "pressure_in": 30.13,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 32,
                  "cloud": 14,
                  "feelslike_c": 24.7,
                  "feelslike_f": 76.5,
                  "windchill_c": 24.8,
                  "windchill_f": 76.6,
                  "heatindex_c": 24.7,
                  "heatindex_f": 76.5,
                  "dewpoint_c": 6.9,
                  "dewpoint_f": 44.5,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 7.5,
                  "gust_kph": 12.0,
                  "uv": 6.2
                },
                {
                  "time_epoch": 1754226000,
                  "time": "2025-08-03 15:00",
                  "temp_c": 25.9,
                  "temp_f": 78.5,
                  "is_day": 1,
                  "condition": {
                    "text": "Partly Cloudy ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/116.png",
                    "code": 1003
                  },
                  "wind_mph": 6.5,
                  "wind_kph": 10.4,
                  "wind_degree": 277,
                  "wind_dir": "W",
                  "pressure_mb": 1020.0,
                  "pressure_in": 30.11,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 31,
                  "cloud": 33,
                  "feelslike_c": 25.3,
                  "feelslike_f": 77.6,
                  "windchill_c": 25.9,
                  "windchill_f": 78.5,
                  "heatindex_c": 25.3,
                  "heatindex_f": 77.6,
                  "dewpoint_c": 7.3,
                  "dewpoint_f": 45.1,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 7.5,
                  "gust_kph": 12.0,
                  "uv": 6.3
                },
                {
                  "time_epoch": 1754229600,
                  "time": "2025-08-03 16:00",
                  "temp_c": 26.6,
                  "temp_f": 79.8,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 7.4,
                  "wind_kph": 11.9,
                  "wind_degree": 290,
                  "wind_dir": "WNW",
                  "pressure_mb": 1020.0,
                  "pressure_in": 30.11,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 31,
                  "cloud": 18,
                  "feelslike_c": 25.9,
                  "feelslike_f": 78.6,
                  "windchill_c": 26.6,
                  "windchill_f": 79.8,
                  "heatindex_c": 25.9,
                  "heatindex_f": 78.6,
                  "dewpoint_c": 8.2,
                  "dewpoint_f": 46.7,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 8.5,
                  "gust_kph": 13.7,
                  "uv": 5.2
                },
                {
                  "time_epoch": 1754233200,
                  "time": "2025-08-03 17:00",
                  "temp_c": 26.8,
                  "temp_f": 80.3,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 8.3,
                  "wind_kph": 13.3,
                  "wind_degree": 293,
                  "wind_dir": "WNW",
                  "pressure_mb": 1019.0,
                  "pressure_in": 30.1,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 32,
                  "cloud": 13,
                  "feelslike_c": 26.1,
                  "feelslike_f": 79.0,
                  "windchill_c": 26.8,
                  "windchill_f": 80.3,
                  "heatindex_c": 26.1,
                  "heatindex_f": 79.0,
                  "dewpoint_c": 8.6,
                  "dewpoint_f": 47.5,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 9.5,
                  "gust_kph": 15.3,
                  "uv": 3.6
                },
                {
                  "time_epoch": 1754236800,
                  "time": "2025-08-03 18:00",
                  "temp_c": 26.5,
                  "temp_f": 79.7,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 8.9,
                  "wind_kph": 14.4,
                  "wind_degree": 301,
                  "wind_dir": "WNW",
                  "pressure_mb": 1019.0,
                  "pressure_in": 30.1,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 32,
                  "cloud": 11,
                  "feelslike_c": 25.9,
                  "feelslike_f": 78.7,
                  "windchill_c": 26.5,
                  "windchill_f": 79.7,
                  "heatindex_c": 25.9,
                  "heatindex_f": 78.7,
                  "dewpoint_c": 8.7,
                  "dewpoint_f": 47.6,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 10.4,
                  "gust_kph": 16.8,
                  "uv": 1.9
                },
                {
                  "time_epoch": 1754240400,
                  "time": "2025-08-03 19:00",
                  "temp_c": 25.5,
                  "temp_f": 77.9,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 8.5,
                  "wind_kph": 13.7,
                  "wind_degree": 312,
                  "wind_dir": "NW",
                  "pressure_mb": 1019.0,
                  "pressure_in": 30.1,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 39,
                  "cloud": 19,
                  "feelslike_c": 25.6,
                  "feelslike_f": 78.1,
                  "windchill_c": 25.5,
                  "windchill_f": 77.9,
                  "heatindex_c": 25.6,
                  "heatindex_f": 78.1,
                  "dewpoint_c": 10.6,
                  "dewpoint_f": 51.1,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 11.1,
                  "gust_kph": 17.8,
                  "uv": 0.5
                },
                {
                  "time_epoch": 1754244000,
                  "time": "2025-08-03 20:00",
                  "temp_c": 22.0,
                  "temp_f": 71.6,
                  "is_day": 1,
                  "condition": {
                    "text": "Sunny",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/113.png",
                    "code": 1000
                  },
                  "wind_mph": 10.1,
                  "wind_kph": 16.2,
                  "wind_degree": 316,
                  "wind_dir": "NW",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.15,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 61,
                  "cloud": 0,
                  "feelslike_c": 24.8,
                  "feelslike_f": 76.6,
                  "windchill_c": 23.0,
                  "windchill_f": 73.4,
                  "heatindex_c": 24.8,
                  "heatindex_f": 76.6,
                  "dewpoint_c": 12.5,
                  "dewpoint_f": 54.4,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 16.0,
                  "gust_kph": 25.8,
                  "uv": 0.2
                },
                {
                  "time_epoch": 1754247600,
                  "time": "2025-08-03 21:00",
                  "temp_c": 21.5,
                  "temp_f": 70.7,
                  "is_day": 1,
                  "condition": {
                    "text": "Partly Cloudy ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/day/116.png",
                    "code": 1003
                  },
                  "wind_mph": 7.8,
                  "wind_kph": 12.6,
                  "wind_degree": 314,
                  "wind_dir": "NW",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.15,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 63,
                  "cloud": 56,
                  "feelslike_c": 21.5,
                  "feelslike_f": 70.6,
                  "windchill_c": 21.5,
                  "windchill_f": 70.6,
                  "heatindex_c": 24.5,
                  "heatindex_f": 76.1,
                  "dewpoint_c": 14.1,
                  "dewpoint_f": 57.4,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 12.8,
                  "gust_kph": 20.5,
                  "uv": 0.0
                },
                {
                  "time_epoch": 1754251200,
                  "time": "2025-08-03 22:00",
                  "temp_c": 20.6,
                  "temp_f": 69.0,
                  "is_day": 0,
                  "condition": {
                    "text": "Partly Cloudy ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/116.png",
                    "code": 1003
                  },
                  "wind_mph": 6.5,
                  "wind_kph": 10.4,
                  "wind_degree": 304,
                  "wind_dir": "NW",
                  "pressure_mb": 1021.0,
                  "pressure_in": 30.16,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 69,
                  "cloud": 60,
                  "feelslike_c": 20.6,
                  "feelslike_f": 69.0,
                  "windchill_c": 20.6,
                  "windchill_f": 69.0,
                  "heatindex_c": 20.6,
                  "heatindex_f": 69.0,
                  "dewpoint_c": 14.7,
                  "dewpoint_f": 58.4,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 10.5,
                  "gust_kph": 16.8,
                  "uv": 0
                },
                {
                  "time_epoch": 1754254800,
                  "time": "2025-08-03 23:00",
                  "temp_c": 20.0,
                  "temp_f": 68.0,
                  "is_day": 0,
                  "condition": {
                    "text": "Partly Cloudy ",
                    "icon": "//cdn.weatherapi.com/weather/64x64/night/116.png",
                    "code": 1003
                  },
                  "wind_mph": 6.3,
                  "wind_kph": 10.1,
                  "wind_degree": 292,
                  "wind_dir": "WNW",
                  "pressure_mb": 1022.0,
                  "pressure_in": 30.17,
                  "precip_mm": 0.0,
                  "precip_in": 0.0,
                  "snow_cm": 0.0,
                  "humidity": 72,
                  "cloud": 36,
                  "feelslike_c": 20.0,
                  "feelslike_f": 68.0,
                  "windchill_c": 20.0,
                  "windchill_f": 68.0,
                  "heatindex_c": 20.0,
                  "heatindex_f": 68.0,
                  "dewpoint_c": 14.9,
                  "dewpoint_f": 58.7,
                  "will_it_rain": 0,
                  "chance_of_rain": 0,
                  "will_it_snow": 0,
                  "chance_of_snow": 0,
                  "vis_km": 10.0,
                  "vis_miles": 6.0,
                  "gust_mph": 10.0,
                  "gust_kph": 16.2,
                  "uv": 0
                }
              ]
            }
          ]
        }
      };

      when(() => mockDioClient.get(
            '${Endpoints.baseUrl}${Endpoints.forecast}',
            queryParameters: {
              'key': Endpoints.apiKey,
              'q': Endpoints.q,
            },
          )).thenAnswer((_) async => Response(
            data: mockJson,
            statusCode: 200,
            requestOptions: RequestOptions(path: ''),
          ));

      final result = await weatherApi.getWeatherData();

      expect(result.$1, isA<Weather>());
      expect(result.$1?.location.name, 'Paris');
      expect(result.$1?.current.tempC, 22.0);
      expect(result.$1?.forecast?.forecastday?.first.hour?.first.tempC, 15.5);
      expect(result.$2, '');
    });

    test('returns error on DioException (network)', () async {
      when(() => mockDioClient.get(
            any(),
            queryParameters: any(named: 'queryParameters'),
          )).thenThrow(DioException(
        requestOptions: RequestOptions(path: ''),
        type: DioExceptionType.connectionError,
      ));

      final result = await weatherApi.getWeatherData();

      expect(result.$1, isNull);
      expect(result.$2, 'Network connection failed');
    });

    test('returns error on HTTP 404 response', () async {
      when(() => mockDioClient.get(
            any(),
            queryParameters: any(named: 'queryParameters'),
          )).thenAnswer((_) async => Response(
            data: {'error': 'City not found'},
            statusCode: 404,
            requestOptions: RequestOptions(path: ''),
          ));

      final result = await weatherApi.getWeatherData();

      expect(result.$1, isNull);
      expect(
          result.$2,
          contains(
              'Network connection failed')); // update your impl to return statusCode in error string
    });

    test('returns error on malformed JSON', () async {
      when(() => mockDioClient.get(
            any(),
            queryParameters: any(named: 'queryParameters'),
          )).thenAnswer((_) async => Response(
            data: {'invalid': 'data'},
            statusCode: 200,
            requestOptions: RequestOptions(path: ''),
          ));

      final result = await weatherApi.getWeatherData();

      expect(result.$1, isNull);
      expect(result.$2, isNotEmpty);
    });
  });
}
